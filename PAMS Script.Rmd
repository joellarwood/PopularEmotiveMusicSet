---
title: "PAMS script"
output: html_notebook
---
# The Popular Music Emotion Set 

Validated stimuli sets are vital for affect and emotion research. This can be seen through sets of vocal stimuli (i.e. [The RAVDESS][1]), images (i.e. [OASIS][2]) and for instrumental music ( the [Jyvaskylla set][3]). However, no validated set exists featuring contemporary, popular, music. An affective set of popular music would be of particular use to researchers, given it is more representative of daily musical, and therefore emotional, engagement. 

The set will be developed using the [`spotifyR`][4] package for R to harvest song data from the top 200 songs of triple j's hottest 100 from 2016-2018 (representing over 7.5 million votes). 

This notebook contains the script for retrieving and sorting the data from the triple j spotify playlists of hottest 100 results. 

[1]: https://smartlaboratory.org/ravdess/
[2]: https://link.springer.com/article/10.3758/s13428-016-0715-3
[3]: https://journals.sagepub.com/doi/10.1177/0305735610362821 
[4]: https://github.com/charlie86/spotifyr



```{r load packages, echo = TRUE, results = 'hide', error=FALSE, warning=FALSE}
install.packages(c("tidyverse", "devtools", "psych", "tableone"))
library(tidyverse)
library(devtools)
library(psych)
library(tableone)
devtools::install_github(repo = "charlie86/spotifyr")
```

#Spotify initial retrival 

```{r}

#get access token 
Sys.setenv(SPOTIFY_CLIENT_ID = '71df4006c91441bc8755ad3b5b9bd0d2')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'b813f0c4195a4dbea22c38d5c42b975c')

access_token <- spotifyr::get_spotify_access_token()


#Triple J URI
triplej <- 'triple.j.abc'

#Playlist URIs
uris <- c("5wYi2543L3beWHAkMeyo2C", "5nSPdyDCKD4VzEuBDP5X25", "5Whhe2btVQw4DokGqkykkw", "5vSiOmiS1UflyJkPBfMvqP", "1hlmJOyuxrfPZi8XvuURbT", "1E8mxc63PDG4U1QAxij9K7")

#retrieve music info

allsongs<-spotifyr::get_playlist_audio_features('triplej', uris)

#get variable names
names(allsongs)

#condense variables 

allsongs <- allsongs %>% select(-contains("uri"),
                                -contains("img"),
                                -contains("at"),
                                -contains("url"),
                                -contains("num"),
                                -contains("id"))

#check condense 
names(allsongs)

```

#Describe the data 
##Continous Variables
```{r describe continuous variables data}
AllContinuous <- allsongs %>% select (contains("popularity"),
                             contains ("dance"),
                             contains("energy"),
                             contains("ness"),
                             contains("valence"),
                             contains("tempo"))


#continuous variables 
psych::describe(AllContinuous)

psych::multi.hist(AllContinuous)


```

##Categorical Variables
```{r describe categorical variables}
AllCat <- allsongs %>% select (-contains("popularity"),
                             -contains("dance"),
                             -contains("energy"),
                             -contains("ness"),
                             -contains("valence"),
                             -contains("tempo"),
                             -contains("name"))

names(AllCat)

CatVars <- c("key", "mode", "key_mode")

print(CreateTableOne(vars=CatVars, data = AllCat))

#Plot 
#key 
AllCat$key <- as.factor(AllCat$key)
ggplot(data = AllCat, aes(x=key)) + geom_bar()

AllCat$mode <-as.factor(AllCat$mode)
ggplot(data = AllCat, aes(x=mode)) + geom_bar()
```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

